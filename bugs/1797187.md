# 1797187

> https://bugs.launchpad.net/starlingx/+bug/1797187

# Process

## From controller-0

```sh
[wrsroot@controller-0 ~(keystone_admin)]$ system host-memory-list compute-0
+-----------+----------------+-------------------+----------------+--------------------------+-----------------+-------------+-------------+------------+-------------+----------------+----------------+------------------+----------------+----------------+------------------+--------------+
| processor | mem_total(MiB) | mem_platform(MiB) | mem_avail(MiB) | hugepages(hp)_configured | vs_hp_size(MiB) | vs_hp_total | vs_hp_avail | vs_hp_reqd | vm_total_4K | vm_hp_total_2M | vm_hp_avail_2M | vm_hp_pending_2M | vm_hp_total_1G | vm_hp_avail_1G | vm_hp_pending_1G | vm_hp_use_1G |
+-----------+----------------+-------------------+----------------+--------------------------+-----------------+-------------+-------------+------------+-------------+----------------+----------------+------------------+----------------+----------------+------------------+--------------+
| 0         | 7269           | 2500              | 7269           | True                     | 2               | 0           | 0           | None       | 1860864     | 0              | 0              | None             | 0              | None           | None             | False        |
+-----------+----------------+-------------------+----------------+--------------------------+-----------------+-------------+-------------+------------+-------------+----------------+----------------+------------------+----------------+----------------+------------------+--------------+
```

[wrsroot@controller-0 ~(keystone_admin)]$ system host-memory-show compute-0 0
+-------------------------------------+--------------------------------------+
| Property                            | Value                                |
+-------------------------------------+--------------------------------------+
| Memory: Usable Total (MiB)          | 7269                                 |
|         Platform     (MiB)          | 2500                                 |
|         Available    (MiB)          | 7269                                 |
| Huge Pages Configured               | True                                 |
| vSwitch Huge Pages: Size (MiB)      | 2                                    |
|                     Total           | 0                                    |
|                     Available       | 0                                    |
|                     Required        | None                                 |
| Application  Pages (4K): Total      | 1860864                              |
| Application  Huge Pages (2M): Total | 0                                    |
|                 Available           | 0                                    |
| Application  Huge Pages (1G): Total | 0                                    |
|                 Available           | None                                 |
| uuid                                | 6925a460-963a-4bba-8cf4-4d70b211c5aa |
| ihost_uuid                          | e2efc721-727f-4166-a2dd-9623dc8fa23b |
| inode_uuid                          | 22f30254-58a5-4bc5-9a14-2eeef74a597e |
| created_at                          | 2019-05-29T14:20:39.508894+00:00     |
| updated_at                          | 2019-05-30T04:53:53.950421+00:00     |
+-------------------------------------+--------------------------------------+


## From compute-0

```
[wrsroot@controller-0 ~(keystone_admin)]$ ssh compute-0

WARNING: Unauthorized access to this system is forbidden and will be
prosecuted by law. By accessing this system, you agree that your
actions may be monitored if unauthorized usage is suspected.

compute-0:~$ 
```

```sh
compute-0:~$ grep GRUB_CMDLINE_LINUX /etc/default/grub
GRUB_CMDLINE_LINUX="security_profile=standard module_blacklist=integrity,ima audit=0 tboot=false crashkernel=auto biosdevname=0 console=ttyS0,115200 iommu=pt usbcore.autosuspend=-1 hugepagesz=2M hugepages=0 default_hugepagesz=2M isolcpus=1 rcu_nocbs=1-2 kthread_cpus=0 irqaffinity=0 selinux=0 enforcing=0 nmi_watchdog=panic,1 softlockup_panic=1 intel_iommu=on user_namespace.enable=1 nopti nospectre_v2"
```

```sh
compute-0:~$ mount | grep huge
cgroup on /sys/fs/cgroup/hugetlb type cgroup (rw,nosuid,nodev,noexec,relatime,hugetlb)
none on /mnt/huge-2048kB type hugetlbfs (rw,relatime,pagesize=2048kB)
none on /dev/huge-2048kB type hugetlbfs (rw,relatime,pagesize=2048kB)
none on /dev/hugepages type hugetlbfs (rw,relatime,pagesize=2M)
```

```sh
compute-0:~$ ls /sys/kernel/mm/hugepages/
hugepages-2048kB
```

```sh
compute-0:~$ ls /sys/devices/system/node/
has_cpu  has_normal_memory  node0  online  possible  power  uevent
```

```sh
[wrsroot@controller-0 ~(keystone_admin)]$ system host-lock compute-0                                                                                                                                                                                                                                                                             
+---------------------+--------------------------------------+
| Property            | Value                                |
+---------------------+--------------------------------------+
| action              | none                                 |
| administrative      | unlocked                             |
| availability        | available                            |
| bm_ip               | None                                 |
| bm_type             | None                                 |
| bm_username         | None                                 |
| boot_device         | sda                                  |
| capabilities        | {}                                   |
| config_applied      | 690348e6-5cee-4f46-aa74-4b9de5230964 |
| config_status       | None                                 |
| config_target       | 690348e6-5cee-4f46-aa74-4b9de5230964 |
| console             | ttyS0,115200                         |
| created_at          | 2019-05-29T14:09:15.968293+00:00     |
| hostname            | compute-0                            |
| id                  | 5                                    |
| install_output      | text                                 |
| install_state       | completed                            |
| install_state_info  | None                                 |
| invprovision        | provisioned                          |
| location            | {}                                   |
| mgmt_ip             | 192.168.204.10                       |
| mgmt_mac            | 52:54:00:19:e2:ea                    |
| operational         | enabled                              |
| personality         | worker                               |
| reserved            | False                                |
| rootfs_device       | sda                                  |
| serialid            | None                                 |
| software_load       | 19.01                                |
| task                | Locking                              |
| tboot               | false                                |
| ttys_dcd            | None                                 |
| updated_at          | 2019-05-30T04:53:58.804686+00:00     |
| uptime              | 49120                                |
| uuid                | e2efc721-727f-4166-a2dd-9623dc8fa23b |
| vim_progress_status | services-enabled                     |
+---------------------+--------------------------------------+
```

```sh
| vim_progress_status | Lock of host compute-0 rejected because there are no other hypervisors |
|                     | available...                                                           |
```
